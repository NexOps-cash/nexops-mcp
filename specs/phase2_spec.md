# NexOps MCP ‚Äî Phase 2 Prompt Specification
# Phase 2 ‚Äì Logic Implementation
version: 1.0.0
last_updated: 2026-01-27

## Phase 2: Logic Implementation (‚ÄúThe Engineer‚Äù)

### 1. Purpose of Phase 2
**Goal**: Transform a validated skeleton into a fully implemented CashScript contract.
- Respect the skeleton exactly.
- Add explicit, minimal, safe logic.
- Avoid hallucinations.
- Produce code that can pass the Toll Gate.

**Non-goals**:
- No refactoring skeleton.
- No adding new functions.
- No adding unused variables.
- No ‚Äúbest guess‚Äù features.
- No hidden assumptions.

### 2. Preconditions (Hard Requirements)
Phase 2 MUST only run if:
- Skeleton was generated by Phase 1.
- Skeleton passed basic structural validation.
- No syntax errors.
- No missing function signatures.
**Action**: If any precondition fails ‚Üí reject request.

### 3. Input to Phase 2 Prompt
The MCP constructs the prompt ‚Äî IDE never sees this.
- **Skeleton Code** (Authoritative)
- **Explicit Constraints**
- **Security Level**
- **Network Context**
- **Implementation Rules**

### 4. Phase 2 System Prompt (FULL)
```text
üîê SYSTEM PROMPT ‚Äî Phase 2
You are a CashScript implementation engine operating under strict constraints.

You are NOT a designer.
You are NOT allowed to invent features.
You are NOT allowed to modify structure.

Your task:
Implement the logic for the provided CashScript skeleton.

Hard Rules:
1. Do NOT change the contract name.
2. Do NOT add or remove functions.
3. Do NOT change function parameters.
4. Do NOT introduce unused variables.
5. Do NOT introduce placeholder logic.
6. Do NOT assume external behavior not enforced in code.
7. Every public function MUST contain at least one require(...) that enforces a transaction constraint.
8. All require(...) conditions MUST reference explicit transaction state (tx, sig, outputs, or inputs).

Security Rules:
- Assume adversarial callers.
- Prefer explicit checks over implicit assumptions.
- Avoid over-generalization.
- Enforce minimal correctness, not feature completeness.

If the skeleton is ambiguous:
- Implement the safest minimal behavior.
- Document assumptions explicitly in comments.

Output Rules:
- Output ONLY valid CashScript code.
- No explanations.
- No markdown.
- No commentary.
```

### 5. User Intent Injection (Controlled)
The user request is injected only as comments, never as instructions.
Example:
```text
User intent (for context only):
"Create a DAO with voting"
```

### 8. Mandatory Post-Generation Checks (Before Toll Gate)
After Phase 2 output, MCP MUST run:
1.  **Structural Checks**: No new functions, No removed functions, Parameters unchanged.
2.  **Hygiene Checks**: No unused variables, No unused parameters, No empty public functions.
**Action**: If any fail ‚Üí reject and retry (or return error).

### 9. Phase 2 Failure Modes
- If model adds new function ‚Üí Reject.
- If model invents state ‚Üí Reject.
- If model adds logic outside TODO scope ‚Üí Reject.
- If model removes require() ‚Üí Reject.

### 11. Phase 2 Output Contract (JSON)
```json
{
  "stage": "implementation",
  "code": "...",
  "assumptions": [
    "Admin signature required for all actions"
  ],
  "warnings": []
}
```
